/*!
    *
    * Wijmo Library 5.20231.879
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(o,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,e){o.__proto__=e}||function(o,e){for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t])})(o,e)};return function(o,e){extendStatics(o,e);function __(){this.constructor=o}o.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),__importStar=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var e={};if(null!=o)for(var t in o)Object.hasOwnProperty.call(o,t)&&(e[t]=o[t]);e.default=o;return e};Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),selfModule=__importStar(require("wijmo/wijmo.grid.transposedmultirow")),_MultiRow=function(o){__extends(_MultiRow,o);function _MultiRow(e,t){var r=o.call(this,e)||this;r._idxData=t;return r}return _MultiRow}(wijmo_grid_1.Row);exports._MultiRow=_MultiRow;var _Cell=function(o){__extends(_Cell,o);function _Cell(e){var t=o.call(this)||this;t._row=t._col=0;t._rowspan=t._colspan=1;wijmo_1.copy(t,e);return t}Object.defineProperty(_Cell.prototype,"row",{get:function(){return this._row},set:function(o){this._row=wijmo_1.asInt(o,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"col",{get:function(){return this._col},set:function(o){this._col=wijmo_1.asInt(o,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"colspan",{get:function(){return this._colspan},set:function(o){this._colspan=wijmo_1.asInt(o,!1,!0);wijmo_1.assert(this._colspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0});Object.defineProperty(_Cell.prototype,"rowspan",{get:function(){return this._rowspan},set:function(o){this._rowspan=wijmo_1.asInt(o,!1,!0);wijmo_1.assert(this._rowspan>0,"colspan must be >= 1")},enumerable:!0,configurable:!0});return _Cell}(wijmo_grid_1.Column);exports._Cell=_Cell;var _CellGroup=function(o){__extends(_CellGroup,o);function _CellGroup(e,t){var r=o.call(this)||this;r._colstart=0;r._rowstart=0;r._layout=e;r._g=e._grid;wijmo_1.copy(r,t);if(!r._cells)throw"Cell group with no cells?";var n=0,i=0;r._cells.forEach((function(o,e){for(;!r._cellFits(o,e,n,i);)0==(i=(i+1)%r.colspan)&&n++;o.row=n;o.col=i}));var l=1,s=1;r._cells.forEach((function(o){l=Math.max(l,o.row+o.rowspan);s=Math.max(s,o.col+o.colspan)}));r.rowspan=l;r.colspan=s;return r}_CellGroup.prototype._copy=function(o,e){var t=this;if("cells"==o){this._cells=[];wijmo_1.isArray(e)&&e.forEach((function(o){var e=new _Cell(o);e.binding&&!e.header&&(e.header=wijmo_1.toHeaderCase(e.binding));t._cells.push(e);t.colspan=Math.max(t.colspan,e.colspan)}));return!0}return!1};Object.defineProperty(_CellGroup.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0});_CellGroup.prototype.closeGroup=function(o){var e=this;if(o>this.colspan){this._cells.forEach((function(t){t.col==e.colspan-1&&(t.colspan=o-t.col)}));this.colspan=o}this._cells.forEach((function(o){for(;o.col+o.colspan<e.colspan&&!e._slotTaken(o.row,o.col+o.colspan);)o.colspan++}));this._cells.forEach((function(o){for(;o.row+o.rowspan<e.rowspan&&!e._slotTaken(o.row+o.rowspan,o.col);)o.rowspan++}));for(var t=0;t<this.rowspan;t++)for(var r=0;r<this.colspan;r++)wijmo_1.assert(this._slotTaken(t,r),"Invalid layout (empty cells).");this._cols=new wijmo_grid_1.ColumnCollection(this._g,this._g.columns.defaultSize);this._rng=new Array(o*this.rowspan);this._cells.forEach((function(o){for(var t=0;t<o.rowspan;t++)for(var r=0;r<o.colspan;r++){var n=(o.row+t)*e.colspan+(o.col+r);e._cols.setAt(n,o);var i=new wijmo_grid_1.CellRange(o.row,o.col,o.row+o.rowspan-1,o.col+o.colspan-1);i.isSingleCell||(e._rng[n]=i)}}));this._rng[-1]=new wijmo_grid_1.CellRange(this._rowstart,this._colstart,this._rowstart+this._rowspan-1,this._colstart)};_CellGroup.prototype.getMergedRange=function(o,e,t){if(t<0)return this._rng[-1];var r=e-this._rowstart,n=t%this.colspan,i=this._rng[r*this.colspan+n];o.cellType==wijmo_grid_1.CellType.RowHeader&&t++;var l=e-r,s=t-n;return i?new wijmo_grid_1.CellRange(l+i.row,s+i.col,l+i.row2,s+i.col2):null};_CellGroup.prototype.getBindingColumn=function(o,e,t){if(t<0)return this;var r=e-this._rowstart,n=t%this.colspan;return this._cols[r*this.colspan+n]};_CellGroup.prototype._cellFits=function(o,e,t,r){if(r>0&&r+o.colspan>this.colspan)return!1;for(var n=0;n<o.colspan;n++)if(this._slotTaken(t,r+n,e))return!1;this.colspan=Math.max(this.colspan,r+o.colspan-1);return!0};_CellGroup.prototype._slotTaken=function(o,e,t){void 0===t&&(t=this._cells.length);for(var r=0;r<t;r++){var n=this._cells[r];if(o>=n.row&&o<=n.row+n.rowspan-1&&e>=n.col&&e<=n.col+n.colspan-1)return!0}return!1};_CellGroup.prototype._updateCellTypes=function(o){this._cols.forEach((function(e){var t=e;null==t.dataType&&t._binding&&(t.dataType=wijmo_1.getType(t._binding.getValue(o)))}))};return _CellGroup}(_Cell);exports._CellGroup=_CellGroup;var _MergeManager=function(o){__extends(_MergeManager,o);function _MergeManager(){return null!==o&&o.apply(this,arguments)||this}_MergeManager.prototype.getMergedRange=function(o,e,t,r){void 0===r&&(r=!0);var n=o.grid;if(e<0||e>=o.rows.length||t<0||t>=o.columns.length)return null;switch(o.cellType){case wijmo_grid_1.CellType.Cell:case wijmo_grid_1.CellType.RowHeader:var i=o.rows[e].dataItem._rowInfo.index,l=t;o.cellType==wijmo_grid_1.CellType.RowHeader&&l--;var s=n._getGroupByRow(e);wijmo_1.assert(s instanceof _CellGroup,"Failed to get the group!");var a=s.getMergedRange(o,i,l);if(a){var u=i,_=e;if(e>0){u=o.rows[e-1].dataItem._rowInfo.index;_=e-1}a.row<=u?a.row=_:a.row=e;var p=i,c=e;if(e<o.rows.length-1){p=o.rows[e+1].dataItem._rowInfo.index;c=e+1}a.row2>=p?a.row2=c:a.row2=e}wijmo_1.assert(!a||a.contains(e,t),"Merged range must contain source cell");return a;case wijmo_grid_1.CellType.ColumnHeader:var w=n.columnsPerItem,d=t-t%w,g=Math.min(d+w-1,o.columns.length-1);return new wijmo_grid_1.CellRange(0,d,o.rows.length-1,g);case wijmo_grid_1.CellType.TopLeft:return new wijmo_grid_1.CellRange(0,0,o.rows.length-1,o.columns.length-1)}return null};return _MergeManager}(wijmo_grid_1.MergeManager);exports._MergeManager=_MergeManager;var _MultiRowLayout=function(){function _MultiRowLayout(o,e){this._columnsPerItem=1;this._bindingGroups=[];this._groupsByRow={};this._grid=o;this._bindingGroups=this._parseCellGroups(e)}Object.defineProperty(_MultiRowLayout.prototype,"totalRowSpan",{get:function(){var o=this._bindingGroups;if(o&&o.length){var e=o[o.length-1];return e._rowstart+e.rowspan}return 0},enumerable:!0,configurable:!0});_MultiRowLayout.prototype._parseCellGroups=function(o){var e=[],t=1;if(o){for(var r=0,n=0;r<o.length;r++){var i=new _CellGroup(this,o[r]);i._rowstart=n;n+=i._rowspan;t=Math.max(t,i._colspan);e.push(i)}e.forEach((function(o){o.closeGroup(t)}));this._columnsPerItem=t}return e};_MultiRowLayout.prototype._getGroupByRow=function(o){var e=this._getGroupIndexByRow(o);return e>-1?this._bindingGroups[e]:null};_MultiRowLayout.prototype._getGroupIndexByRow=function(o){var e=this._groupsByRow[o];if(e)return e;for(var t=this._bindingGroups,r=0;r<t.length;r++){var n=t[r];if(o>=n._rowstart&&o<=n._rowstart+n._rowspan-1){this._groupsByRow[o]=r;return r}}return-1};_MultiRowLayout.prototype._updateCellTypes=function(o){this._bindingGroups.forEach((function(e){e._updateCellTypes(o)}))};return _MultiRowLayout}();exports._MultiRowLayout=_MultiRowLayout;var TransposedMultiRow=function(o){__extends(TransposedMultiRow,o);function TransposedMultiRow(e,t){var r=o.call(this,e)||this;r._currentPos=-1;r._bindingColumns={};r._keyPrefix="item";wijmo_1.addClass(r.hostElement,"wj-transposed-multirow");r._layout=new _MultiRowLayout(r,null);r.allowDragging=wijmo_grid_1.AllowDragging.None;r.allowSorting=wijmo_grid_1.AllowSorting.None;r.mergeManager=new _MergeManager;r.formatItem.addHandler(r._formatItem,r);r._rowInfo=new wijmo_grid_1.ColumnCollection(r,r.columns.defaultSize);r.initialize(t);r._rowInfo.collectionChanged.addHandler(r._rowInfoChanged,r);return r}Object.defineProperty(TransposedMultiRow.prototype,"layoutDefinition",{get:function(){return this._layoutDef},set:function(o){this._layoutDef=wijmo_1.asArray(o);this._layout=new _MultiRowLayout(this,o);this._rowInfoChanged()},enumerable:!0,configurable:!0});TransposedMultiRow.prototype.getBindingColumn=function(o,e,t){if(o.cellType!=wijmo_grid_1.CellType.Cell)return null;var r=o.rows[e].dataItem._rowInfo.index,n=r+"_"+t,i=this._bindingColumns[n];if(i)return i;var l=this._getGroupByRow(e).getBindingColumn(o,r,t);if(l){i=new wijmo_grid_1.Column;wijmo_grid_1.FlexGrid._getSerializableProperties(wijmo_grid_1.Column).forEach((function(o){null!=l[o]&&(i[o]=l[o])}));var s=Math.floor(t/this.columnsPerItem),a=t%this.columnsPerItem;i.binding=this._keyPrefix+s+"_"+a;this._bindingColumns[n]=i}return i};Object.defineProperty(TransposedMultiRow.prototype,"columnsPerItem",{get:function(){return this._layout._columnsPerItem},enumerable:!0,configurable:!0});Object.defineProperty(TransposedMultiRow.prototype,"allowAddNew",{get:function(){return!1},set:function(o){wijmo_1.assert(!o,"TransposedMultiRow does not support items addition.")},enumerable:!0,configurable:!0});Object.defineProperty(TransposedMultiRow.prototype,"allowDelete",{get:function(){return!1},set:function(o){wijmo_1.assert(!o,"TransposedMultiRow does not support items deletion.")},enumerable:!0,configurable:!0});Object.defineProperty(TransposedMultiRow.prototype,"allowDragging",{get:function(){return wijmo_grid_1.AllowDragging.None},set:function(o){wijmo_1.assert(o===wijmo_grid_1.AllowDragging.None,"TransposedMultiRow does not support dragging.");if(o!==this._alDragging){this._alDragging=o;this.invalidate()}},enumerable:!0,configurable:!0});Object.defineProperty(TransposedMultiRow.prototype,"allowPinning",{get:function(){return!1},set:function(o){wijmo_1.assert(!o,"TransposedMultiRow does not support pinning.")},enumerable:!0,configurable:!0});Object.defineProperty(TransposedMultiRow.prototype,"allowSorting",{get:function(){return wijmo_grid_1.AllowSorting.None},set:function(o){wijmo_1.assert(o===wijmo_grid_1.AllowSorting.None,"TransposedMultiRow does not support sorting.");this._alSorting=o},enumerable:!0,configurable:!0});Object.defineProperty(TransposedMultiRow.prototype,"columnLayout",{get:function(){throw"TransposedMultiRow does not support column layout."},set:function(o){throw"TransposedMultiRow does not support column layout."},enumerable:!0,configurable:!0});TransposedMultiRow.prototype.refresh=function(e){var t=this._rowInfo;if(t._dirty){t._dirty=!1;this._rowInfoChanged()}else o.prototype.refresh.call(this,e)};TransposedMultiRow.prototype.onLoadedRows=function(e){for(var t=this,r=this.columnHeaders.columns,n=0;n<r.length;n++)this.columnHeaders.setCellData(0,n,"");var i=this.columns;for(n=0;n<i.length;n++){var l=i[n];l.align=null;l.dataType=0}var s=this.rowHeaders.columns;this.rows.forEach((function(o){var e=o.dataItem._rowInfo;if(e)for(var r=s.length-2;r>=0;r--){var n=e.headers[r]||wijmo_1.toHeaderCase(e.bindings[r]);t.rowHeaders.setCellData(o.index,r+1,n)}}));s[0].visible=!1;for(n=1;n<s.length;n++){s[n].align="left";s[n].visible=!0;s[n].width=this.columns.defaultSize}o.prototype.onLoadedRows.call(this,e)};TransposedMultiRow.prototype._getGroupByRow=function(o){var e=this.cells.rows[o].dataItem._rowInfo.index,t=this._layout._getGroupByRow(e);wijmo_1.assert(t instanceof _CellGroup,"Failed to get the group!");return t};TransposedMultiRow.prototype._addBoundRow=function(o,e){var t=o[e];this.rows.push(new _MultiRow(t,e))};TransposedMultiRow.prototype._updateColumnTypes=function(){o.prototype._updateColumnTypes.call(this);var e=this.collectionView;if(wijmo_1.hasItems(e)&&this._layout){var t=e.items[0]._arr;t&&t.length>0&&this._layout._updateCellTypes(t[0])}};TransposedMultiRow.prototype._getBindingColumn=function(e,t,r){if(this._layout){e==this.cells&&(r=this.getBindingColumn(e,t,r.index));return r}return o.prototype._getBindingColumn.call(this,e,t,r)};TransposedMultiRow.prototype._isTransposed=function(){return!0};TransposedMultiRow.prototype._autoSizeRows=function(){this.autoSizeMode&wijmo_grid_1.AutoSizeMode.Both&&this.autoSizeRows();o.prototype._autoSizeRows.call(this)};TransposedMultiRow.prototype.onRowEditEnded=function(e){if(null!=this._view){var t=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change);this._view.collectionChanged.raise(this._view,t)}o.prototype.onRowEditEnded.call(this,e)};TransposedMultiRow.prototype._getCollectionView=function(e){var t=null;null!=this._view&&this._view.collectionChanged.removeHandler(this._sourceViewChanged);if(wijmo_1.isArray(e))e=this._transposeItemsSource(e);else if(e){this._view&&this._view.collectionChanged.removeHandler(this._sourceViewChanged);this._view=wijmo_1.tryCast(e,"ICollectionView");if(this._view){this._view.collectionChanged.addHandler(this._sourceViewChanged,this);e instanceof wijmo_1.CollectionView&&(t=e.getError);e=this._transposeItemsSource(this._view.items)}}this.autoGenerateColumns=!0;var r=o.prototype._getCollectionView.call(this,e);r&&this._currentPos>=0&&(r.currentPosition=Math.min(r.items.length-1,this._currentPos));t&&r instanceof wijmo_1.CollectionView&&(r.getError=function(o,e){if(null==e)return null;var r=o._keys.indexOf(e),n=r%o._bnd.length,i=Math.floor(r/o._bnd.length);return t(o._arr[i],o._bnd[n].path)});return r};TransposedMultiRow.prototype._rowInfoChanged=function(){try{var o=this.collectionView;this._currentPos=o?o.currentPosition:-1;var e=this.selection;this._bindingColumns={};var t=this.itemsSource;this.itemsSource=null;this.itemsSource=t;e&&e.isValid&&(this.selection=e)}finally{this._currentPos=-1}};TransposedMultiRow.prototype._formatItem=function(o,e){var t=this.columnsPerItem,r=e.panel,n=r.cellType,i=r.rows[e.range.row],l=(r.rows[e.range.row2],e.cell);n==wijmo_grid_1.CellType.RowHeader&&wijmo_1.toggleClass(l,"wj-group-header",0==e.range.row);if(n==wijmo_grid_1.CellType.Cell||n==wijmo_grid_1.CellType.RowHeader){var s=this._getGroupByRow(e.row);wijmo_1.toggleClass(l,"wj-group-start",s._rowstart==e.range.row);wijmo_1.toggleClass(l,"wj-group-end",s._rowstart+s._rowspan-1==e.range.row2)}if(t>1&&(n==wijmo_grid_1.CellType.Cell||n==wijmo_grid_1.CellType.ColumnHeader)){wijmo_1.toggleClass(l,"wj-record-start",e.range.col%t==0);wijmo_1.toggleClass(l,"wj-record-end",e.range.col2%t==t-1)}var a=this.alternatingRowStep;if(a&&n==wijmo_grid_1.CellType.Cell){var u=this._layout.totalRowSpan,_=this._layout._bindingGroups.length,p=Math.floor(i.dataIndex/u)*_,c=i.dataIndex%u,w=(p+=this._layout._getGroupIndexByRow(c)+1)%(a+1)==0;wijmo_1.toggleClass(l,"wj-alt",w)}if(n==wijmo_grid_1.CellType.RowHeader){var d=i.dataItem._rowInfo,g=(s=this._getGroupByRow(e.row)).getBindingColumn(r,d.index,e.col);wijmo_1.toggleClass(l,"wj-wrap",g.wordWrap)}};TransposedMultiRow.prototype._sourceViewChanged=function(o,e){this.activeEditor||this.invalidate()};TransposedMultiRow.prototype._transposeItemsSource=function(o){var e=this,t=new wijmo_1.ObservableArray;if(this._layout&&this._layout._bindingGroups.length){this._getRowInfo(o).forEach((function(r,n){var i=e._createKeys(o);if(e._supportsProxies()){var l=e._createProxy(o,r,i);t.push(l)}else{var s=e._createTransposedObject(o,r,i);t.push(s)}}));o instanceof wijmo_1.ObservableArray&&o.collectionChanged.addHandler((function(o,r){if(r.action===wijmo_1.NotifyCollectionChangedAction.Change)e.activeEditor||e.invalidate();else{var n=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Reset);t.onCollectionChanged(n);e._rowInfoChanged()}}))}return t};TransposedMultiRow.prototype._createKeys=function(o){var e=this,t=Array.apply(null,{length:this.columnsPerItem}),r=o.map((function(o,r){return t.map((function(o,t){return e._keyPrefix+r+"_"+t}))}));return[].concat.apply([],r)};TransposedMultiRow.prototype._supportsProxies=function(){return null!=window.Proxy};TransposedMultiRow.prototype._createProxy=function(o,e,t){var r={_arr:o,_rowInfo:e,_bnd:e.bindings.map((function(o){return new wijmo_1.Binding(o)})),_keys:t};return new Proxy(r,{ownKeys:function(o){return o._keys},getOwnPropertyDescriptor:function(){return{enumerable:!0,configurable:!0,writable:!0}},get:function(o,e){var t=o._keys.indexOf(e);if(t>-1){var r=o._bnd,n=o._arr,i=r.length,l=t%i,s=Math.floor(t/i);return r[l].getValue(n[s])}return o[e]},set:function(o,e,t){var r=o._keys.indexOf(e);if(r>-1){var n=o._bnd,i=o._arr,l=n.length,s=r%l,a=Math.floor(r/l);n[s].setValue(i[a],t);if(i instanceof wijmo_1.ObservableArray||i instanceof wijmo_1.CollectionView){var u=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,i[a],a);i.onCollectionChanged(u)}return!0}return!1}})};TransposedMultiRow.prototype._createTransposedObject=function(o,e,t){for(var r={_arr:o,_rowInfo:e,_bnd:e.bindings.map((function(o){return new wijmo_1.Binding(o)})),_keys:t},_loop_1=function(e){var n=t[e];Object.defineProperty(r,n,{enumerable:!0,get:function(){var t=r._bnd,n=t.length,i=e%n,l=Math.floor(e/n);return t[i].getValue(o[l])},set:function(t){var n=r._bnd,i=n.length,l=e%i,s=Math.floor(e/i);n[l].setValue(o[s],t);if(o instanceof wijmo_1.ObservableArray){var a=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,o[s],s);o.onCollectionChanged(a)}return!0}})},n=0;n<t.length;n++)_loop_1(n);return r};TransposedMultiRow.prototype._getRowInfo=function(o){var e=[];if(this._layout){for(var t=this.rowHeaders.columns,r=this.columnsPerItem+1;t.length>r;)t.removeAt(t.length-1);for(;t.length<r;)t.push(new wijmo_grid_1.Column);this._layout._bindingGroups.forEach((function(o){for(var t=0;t<o.rowspan;t++){for(var r={index:o._rowstart+t,bindings:[],headers:[]},n=0;n<o.colspan;n++)for(var i=0;i<o.cells.length;i++){var l=o.cells[i];if(t>=l.row&&t<l.row+l.rowspan&&n>=l.col&&n<l.col+l.colspan){r.bindings.push(l.binding);r.headers.push(l.header);break}}e.push(r)}}))}return e};return TransposedMultiRow}(wijmo_grid_1.FlexGrid);exports.TransposedMultiRow=TransposedMultiRow;wijmo_1._registerModule("wijmo.grid.transposedmultirow",selfModule);