/*!
    *
    * Wijmo Library 5.20231.879
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),selfModule=__importStar(require("wijmo/wijmo.grid.search")),FlexGridSearch=function(e){__extends(FlexGridSearch,e);function FlexGridSearch(t,r){var i=e.call(this,t)||this;i._delay=wijmo_1.Control._SEARCH_DELAY;i._cssMatch="wj-state-match";i._searchAllColumns=!1;i._rxSrch=null;i._rxHilite=null;var n=i.getTemplate();i.applyTemplate("wj-control wj-content wj-flexgridsearch",n,{_tbx:"input",_btn:"btn"},"input");i._filterBnd=i._filter.bind(i);i._tbx.addEventListener("input",(function(){i._toSearch&&clearTimeout(i._toSearch);i._toSearch=setTimeout((function(){i._toSearch=null;i._applySearch()}),i._delay)}));i._btn.addEventListener("click",(function(){i._toSearch&&clearTimeout(i._toSearch);i._toSearch=null;i._tbx.value="";i._applySearch();i.containsFocus()&&i._tbx.focus()}));i.initialize(r);return i}Object.defineProperty(FlexGridSearch.prototype,"grid",{get:function(){return this._g},set:function(e){if((e=wijmo_1.asType(e,wijmo_grid_1.FlexGrid,!0))!=this._g){var t=this._g;if(t){t.formatItem.removeHandler(this._formatItem);t.itemsSourceChanged.removeHandler(this._itemsSourceChanged)}t=this._g=e;this._itemsSourceChanged();if(t){t.formatItem.addHandler(this._formatItem,this);t.itemsSourceChanged.addHandler(this._itemsSourceChanged,this)}}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"inputElement",{get:function(){return this._tbx},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"text",{get:function(){return this._tbx.value},set:function(e){if(e!=this.text){this._tbx.value=wijmo_1.asString(e);this._applySearch()}},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"delay",{get:function(){return this._delay},set:function(e){this._delay=wijmo_1.asNumber(e,!1,!0)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"placeholder",{get:function(){return this._tbx.placeholder},set:function(e){this._tbx.placeholder=e},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"cssMatch",{get:function(){return this._cssMatch},set:function(e){this._cssMatch=wijmo_1.asString(e)},enumerable:!0,configurable:!0});Object.defineProperty(FlexGridSearch.prototype,"searchAllColumns",{get:function(){return this._searchAllColumns},set:function(e){this._searchAllColumns=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0});FlexGridSearch.prototype._formatItem=function(e,t){if(this._rxHilite&&this._cssMatch&&t.panel==e.cells&&!t.getColumn()._getFlag(wijmo_grid_1.RowColFlags.HasTemplate)&&!t.cell.querySelector("input")){var r=t.cell.innerHTML;this._rxHilite.test(r)&&(t.cell.innerHTML=r.replace(this._rxHilite,'<span class="'+this._cssMatch+'">$1</span>'))}};FlexGridSearch.prototype._itemsSourceChanged=function(){this._cv&&this._cv.filters.remove(this._filterBnd);var e=this._g?this._g.collectionView:null;this._cv=e instanceof wijmo_1.CollectionView?e:null;this._cv&&this._cv.filters.push(this._filterBnd)};FlexGridSearch.prototype._applySearch=function(){var e=this._g;this._rxSrch=this._rxHilite=null;var t=wijmo_1.escapeRegExp(this.text).split(" ").filter((function(e){return e}));if(t.length){var r=e&&e.caseSensitiveSearch?"g":"gi";this._rxSrch=new RegExp("(?=.*"+t.join(")(?=.*")+")",r);t=t.map((function(e){return _escapeHtml(e)}));this._rxHilite=new RegExp("("+t.join("|")+")(?![^<]*>)",r)}var i=e?e.collectionView:null;i instanceof wijmo_1.CollectionView&&i.refresh()};FlexGridSearch.prototype._filter=function(e){if(this._rxSrch&&this._g){var t=this._getItemText(e);return this._rxSrch.test(t)}return!0};FlexGridSearch.prototype._getItemText=function(e){for(var t=[],r=this._g._getBindingColumns(),i=0;i<r.length;i++){var n=r[i],o=n._binding;if(o&&(n.visible||this.searchAllColumns)){var l=o.getValue(e);l=n.dataMap?n.dataMap.getDisplayValue(l):wijmo_1.Globalize.format(l,n.format);n.isContentHtml&&(l=wijmo_1.toPlainText(l));l&&t.push(l)}}return t.join(" ")};FlexGridSearch.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"/><span wj-part="btn" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1">&times</button></span></div></div></div>';return FlexGridSearch}(wijmo_1.Control);exports.FlexGridSearch=FlexGridSearch;var _ENTITYMAP={"&":"&amp;","<":"&lt;",">":"&gt;"};function _escapeHtml(e){e&&wijmo_1.isString(e)&&(e=e.replace(/[&<>]/g,(function(e){return _ENTITYMAP[e]})));return null!=e?e.toString():""}wijmo_1._registerModule("wijmo.grid.search",selfModule);