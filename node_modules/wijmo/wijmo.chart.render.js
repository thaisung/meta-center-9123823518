/*!
    *
    * Wijmo Library 5.20231.879
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_chart_1=require("wijmo/wijmo.chart"),selfModule=__importStar(require("wijmo/wijmo.chart.render")),_CanvasRenderEngine=function(){function _CanvasRenderEngine(e,t){void 0===t&&(t=!1);this._strokeWidth=1;this._fontSize=null;this._fontFamily=null;this._cssPriority=!0;this._readOnly=!1;this._applyCanvasClip=function(e,t){var n=this._canvasRect[t];if(n){e.beginPath();e.rect(n.left,n.top,n.width,n.height);e.clip();e.closePath()}};this._applyCanvasStyles=function(e,t,n,i,a){var r,s,o,l=this._canvas.getContext("2d"),h=this.stroke,p=this.fill,_=this.strokeWidth;t&&void 0!==t.stroke&&(h=t.stroke);t&&void 0!==t.fill&&(p=this._getOpacityColor(t.fill,t["fill-opacity"]));if(e){s=window.getComputedStyle(e);o=e.getBBox()}if(a){if(s){l.fillStyle=s.fill;r=s.fontStyle+" "+s.fontWeight+" "+s.fontSize+" "+s.fontFamily;l.font=r}else if(this.fontSize){l.fillStyle=this.textFill;l.font=this.fontSize+" "+(this.fontFamily||"sans-serif")}else if(this._canvasDefaultFont){l.fillStyle=this._canvasDefaultFont.textFill;r=this._canvasDefaultFont.fontSize+" "+this._canvasDefaultFont.fontFamily;l.font=r;if(l.font.replace(/\"/g,"'")!==r.replace(/\"/g,"'")){r=this._canvasDefaultFont.fontSize+" "+(l.font.split(" ")[1]||"sans-serif");l.font=r}}}else{if(s){h=s.stroke&&"none"!==s.stroke?s.stroke:h;p=s.fill&&"none"!==s.fill?this._getOpacityColor(s.fill,s["fill-opacity"]):p;_=s.strokeWidth?s.strokeWidth:_}if("none"!==h&&null!=h){this._applyColor("strokeStyle",h,o);l.lineWidth=+_.replace(/px/g,"");l.stroke()}if(i&&null!=p&&"transparent"!==p&&"none"!==p){this._applyColor("fillStyle",p,o);l.fill()}}};this._element=e;this._canvas=document.createElement("canvas");this._svgEngine=new wijmo_chart_1._SvgRenderEngine(e);this._element.appendChild(this._canvas);this._applyCSSStyles=t}_CanvasRenderEngine.prototype.beginRender=function(){var e,t=this._svgEngine.element,n=this._element;if(this._applyCSSStyles){this._svgEngine.beginRender();n=t}this._element.appendChild(t);this._canvasRect={};e=window.getComputedStyle(n);this._canvasDefaultFont={fontSize:e.fontSize,fontFamily:e.fontFamily,textFill:e.color}};_CanvasRenderEngine.prototype.endRender=function(){this._applyCSSStyles&&this._svgEngine.endRender();this._svgEngine.element.parentNode.removeChild(this._svgEngine.element)};_CanvasRenderEngine.prototype.setViewportSize=function(e,t){var n=this._canvas;n.getContext("2d"),this.fill;this._applyCSSStyles&&this._svgEngine.setViewportSize(e,t);n.width=e;n.height=t};Object.defineProperty(_CanvasRenderEngine.prototype,"element",{get:function(){return this._canvas},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"fill",{get:function(){return this._fill},set:function(e){this._svgEngine.fill=e;this._fill=e},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._svgEngine.fontSize=e;var t=null==e||isNaN(e)?e:e+"px";this._fontSize=t},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this._svgEngine.fontFamily=e;this._fontFamily=e},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"stroke",{get:function(){return this._stroke},set:function(e){this._svgEngine.stroke=e;this._stroke=e},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"strokeWidth",{get:function(){return this._strokeWidth},set:function(e){this._svgEngine.strokeWidth=e;this._strokeWidth=e},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"textFill",{get:function(){return this._textFill},set:function(e){this._svgEngine.textFill=e;this._textFill=e},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"cssPriority",{get:function(){return this._cssPriority},set:function(e){this._svgEngine.cssPriority=e;this._cssPriority=e},enumerable:!0,configurable:!0});Object.defineProperty(_CanvasRenderEngine.prototype,"readOnly",{get:function(){return this._readOnly},set:function(e){this._readOnly=e},enumerable:!0,configurable:!0});_CanvasRenderEngine.prototype.addClipRect=function(e,t){if(e&&t){this._applyCSSStyles&&this._svgEngine.addClipRect(e,t);this._canvasRect[t]=e.clone()}};_CanvasRenderEngine.prototype.drawEllipse=function(e,t,n,i,a,r){if(!this.readOnly){var s,o=this._canvas.getContext("2d");this._applyCSSStyles&&(s=this._svgEngine.drawEllipse(e,t,n,i,a,r));o.save();o.beginPath();if(o.ellipse)o.ellipse(e,t,n,i,0,0,2*Math.PI);else{o.translate(e,t);o.scale(1,i/n);o.translate(-e,-t);o.arc(e,t,n,0,2*Math.PI);o.scale(1,1)}this._applyCanvasStyles(s,r,a,!0);o.restore();return s}};_CanvasRenderEngine.prototype.drawRect=function(e,t,n,i,a,r,s){if(!this.readOnly){var o,l=this._canvas.getContext("2d");this._applyCSSStyles&&(o=this._svgEngine.drawRect(e,t,n,i,a,r,s));l.save();this._applyCanvasClip(l,s);l.beginPath();l.rect(e,t,n,i);this._applyCanvasStyles(o,r,a,!0);l.restore();return o}};_CanvasRenderEngine.prototype.drawLine=function(e,t,n,i,a,r){if(!this.readOnly){var s,o=this._canvas.getContext("2d");this._applyCSSStyles&&(s=this._svgEngine.drawLine(e,t,n,i,a,r));o.save();o.beginPath();o.moveTo(e,t);o.lineTo(n,i);this._applyCanvasStyles(s,r,a);o.restore();return s}};_CanvasRenderEngine.prototype.drawLines=function(e,t,n,i,a,r){if(e&&t&&0!==e.length&&0!==t.length&&!this.readOnly){var s,o,l=this._canvas.getContext("2d"),h=r||Math.min(e.length,t.length);this._applyCSSStyles&&(s=this._svgEngine.drawLines([0,1],[1,0],n,i,a));l.save();this._applyCanvasClip(l,a);l.beginPath();l.moveTo(e[0],t[0]);for(o=1;o<h;o++)l.lineTo(e[o],t[o]);this._applyCanvasStyles(s,i,n);l.restore();return s}};_CanvasRenderEngine.prototype.drawSplines=function(e,t,n,i,a,r){if(e&&t&&0!==e.length&&0!==t.length&&!this.readOnly){var s,o,l=this._canvas.getContext("2d"),h=new wijmo_chart_1._Spline(e,t,r).calculate(),p=h.xs,_=h.ys,f=Math.min(p.length,_.length);this._applyCSSStyles&&(s=this._svgEngine.drawSplines([0,1],[1,0],n,i,a));l.save();this._applyCanvasClip(l,a);l.beginPath();l.moveTo(p[0],_[0]);for(o=1;o<f;o++)l.lineTo(p[o],_[o]);this._applyCanvasStyles(s,i,n);l.restore();return s}};_CanvasRenderEngine.prototype.drawPolygon=function(e,t,n,i,a){if(e&&t&&0!==e.length&&0!==t.length&&!this.readOnly){var r,s,o=this._canvas.getContext("2d"),l=Math.min(e.length,t.length);this._applyCSSStyles&&(r=this._svgEngine.drawPolygon(e,t,n,i,a));o.save();this._applyCanvasClip(o,a);o.beginPath();o.moveTo(e[0],t[0]);for(s=1;s<l;s++)o.lineTo(e[s],t[s]);o.closePath();this._applyCanvasStyles(r,i,n,!0);o.restore();return r}};_CanvasRenderEngine.prototype.drawPieSegment=function(e,t,n,i,a,r,s,o){if(!this.readOnly){var l,h=this._canvas.getContext("2d"),p=i,_=i+a;this._applyCSSStyles&&(l=this._svgEngine.drawPieSegment(e,t,n,i,a,r,s,o));h.save();this._applyCanvasClip(h,o);h.beginPath();h.moveTo(e,t);h.arc(e,t,n,p,_,!1);h.lineTo(e,t);this._applyCanvasStyles(l,s,r,!0);h.restore();return l}};_CanvasRenderEngine.prototype.drawDonutSegment=function(e,t,n,i,a,r,s,o,l){if(!this.readOnly){var h,p,_,f=this._canvas.getContext("2d"),g=a,y=a+r;this._applyCSSStyles&&(h=this._svgEngine.drawDonutSegment(e,t,n,i,a,r,s,o,l));(p=new wijmo_1.Point(e,t)).x+=i*Math.cos(g);p.y+=i*Math.sin(g);(_=new wijmo_1.Point(e,t)).x+=i*Math.cos(y);_.y+=i*Math.sin(y);f.save();this._applyCanvasClip(f,l);f.beginPath();f.moveTo(p.x,p.y);f.arc(e,t,n,g,y,!1);f.lineTo(_.x,_.y);f.arc(e,t,i,y,g,!0);this._applyCanvasStyles(h,o,s,!0);f.restore();return h}};_CanvasRenderEngine.prototype.drawString=function(e,t,n,i){if(!this.readOnly){var a,r=this._canvas.getContext("2d");this._applyCSSStyles&&(a=this._svgEngine.drawString(e,t,n,i));r.save();r.textBaseline="bottom";this._applyCanvasStyles(a,i,n,!0,!0);r.fillText(e,t.x,t.y);r.restore();return a}};_CanvasRenderEngine.prototype.drawStringRotated=function(e,t,n,i,a,r){if(!this.readOnly){var s,o=this._canvas.getContext("2d");o.measureText(e);this._applyCSSStyles&&(s=this._svgEngine.drawStringRotated(e,t,n,i,a,r));o.save();o.textBaseline="bottom";o.translate(n.x,n.y);o.rotate(Math.PI/180*i);o.translate(-n.x,-n.y);this._applyCanvasStyles(s,r,a,!0,!0);o.fillText(e,t.x,t.y);o.restore();return s}};_CanvasRenderEngine.prototype.measureString=function(e,t,n,i){var a,r=r=this._canvas.getContext("2d");if(this._applyCSSStyles)return this._svgEngine.measureString(e,t,n,i);this._applyCanvasStyles(null,null,t,!0,!0);a=r.measureText(e).width;return new wijmo_1.Size(a,1.5*parseInt(r.font))};_CanvasRenderEngine.prototype.startGroup=function(e,t,n){void 0===n&&(n=!1);var i,a=this._canvas.getContext("2d");this._applyCSSStyles&&(i=this._svgEngine.startGroup(e,t,n));a.save();this._applyCanvasClip(a,t);return i};_CanvasRenderEngine.prototype.endGroup=function(){this._applyCSSStyles&&this._svgEngine.endGroup();this._canvas.getContext("2d").restore()};_CanvasRenderEngine.prototype.drawImage=function(e,t,n,i,a){if(!this.readOnly){var r,s=this._canvas.getContext("2d"),o=new Image;this._applyCSSStyles&&(r=this._svgEngine.drawImage(e,t,n,i,a));o.onload=function(){s.drawImage(o,t,n,i,a)};o.src=e;return r}};_CanvasRenderEngine.prototype._getOpacityColor=function(e,t){var n=new wijmo_1.Color(e);if(e.indexOf("url")>-1)return this.fill;if(e.indexOf("-")>-1){this.fill=e;return e}null!=t&&1===n.a&&(n.a=isNaN(t)?1:Number(t));return n.toString()};_CanvasRenderEngine.prototype._applyColor=function(e,t,n){var i=_GradientColorUtil.tryParse(t),a=this._canvas.getContext("2d");if(null!=i)if(wijmo_1.isString(i)||null==n)a[e]=i;else{var r;if(null!=i.x1)r=i.relative?a.createLinearGradient(n.x+i.x1*n.width,n.y+i.y1*n.height,n.x+i.x2*n.width,n.y+i.y2*n.height):a.createLinearGradient(i.x1,i.y1,i.x2,i.y2);else if(null!=i.r)if(i.relative){var s=n.x+i.cx*n.width,o=n.y+i.cy*n.height,l=i.r*n.width,h=i.r*n.height/l,p=n.x+(null==i.fx?i.cx:i.fx)*n.width,_=n.y+(null==i.fy?i.cy:i.fy)*n.height,f=(null==i.fr?0:i.fr)*n.width,g=(null==i.fr?0:i.fr)*n.height,y=Math.min(f,g);r=a.createRadialGradient(p,_/h,y,s,o/h,l);a.setTransform(1,0,0,h,0,0)}else r=a.createRadialGradient(null==i.fx?i.cx:i.fx,null==i.fy?i.cy:i.fy,i.fr||0,i.cx,i.cy,i.r);i.colors&&i.colors.length>0&&null!=r&&i.colors.forEach((function(e){var t=new wijmo_1.Color("#000000");null!=e.color&&(t=e.color);null!=e.opacity&&(t.a=e.opacity);r.addColorStop(e.offset,t.toString())}));a[e]=r}};return _CanvasRenderEngine}();exports._CanvasRenderEngine=_CanvasRenderEngine;var _GradientColorUtil=function(){function _GradientColorUtil(){}_GradientColorUtil.tryParse=function(e){if(_GradientColorUtil.parsedColor[e])return _GradientColorUtil.parsedColor[e];if(null==e||-1===e.indexOf("-"))return e;var t,n=e.replace(/\s+/g,"").split(/\-/g),i=n[0][0],a=!1,r=n[0].match(/\(\S+\)/)[0].replace(/[\(\\)]/g,"").split(/\,/g);if("l"===i||"L"===i){t={x1:"0",y1:"0",x2:"0",y2:"0",colors:[]};"l"===i&&(a=!0);["x1","y1","x2","y2"].forEach((function(e,n){null!=r[n]&&(t[e]=+r[n])}))}else if("r"===i||"R"===i){t={cx:"0",cy:"0",r:"0",colors:[]};"r"===i&&(a=!0);["cx","cy","r","fx","fy","fr"].forEach((function(e,n){null!=r[n]&&""!==r[n]&&(t[e]=+r[n])}))}t.relative=a;_GradientColorUtil.parsedColor[e]=t;var s=n.length-1;n.forEach((function(e,n){e.indexOf(")")>-1&&(e=e.match(/\)\S+/)[0].replace(")",""));var i=e.split(":"),a={color:new wijmo_1.Color("#000000")};null!=i[0]&&(a.color=wijmo_1.Color.fromString(i[0]));null!=i[1]?a.offset=+i[1]:a.offset=n/s;null!=i[2]&&(a.opacity=+i[2]);t.colors.push(a)}));return t};_GradientColorUtil.parsedColor={};return _GradientColorUtil}();if(wijmo_chart_1.FlexChartBase&&wijmo_chart_1.FlexChartBase.prototype&&wijmo_chart_1.FlexChartBase.prototype._exportToImage){var _exportFn=wijmo_chart_1.FlexChartBase.prototype._exportToImage;wijmo_chart_1.FlexChartBase.prototype._exportToImage=function(e,t){if("svg"!==e){var n=this._bgColor(this.hostElement);this._isTransparent(n)&&(n="#ffffff");var i,a,r=new _CanvasRenderEngine(this.hostElement,!0);this._render(r,!1,n);i=(a=r.element).toDataURL("image/"+e);a.parentNode.removeChild(a);t.call(null,i);a=null;r=null}else _exportFn.call(this,e,t)}}wijmo_1._registerModule("wijmo.chart.render",selfModule);