/*!
    *
    * Wijmo Library 5.20231.879
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);e.default=t;return e};Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),selfModule=__importStar(require("wijmo/wijmo.touch")),DataTransfer=function(){function DataTransfer(){this._dropEffect="move";this._effectAllowed="all";this._data={}}Object.defineProperty(DataTransfer.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=wijmo_1.asString(t)},enumerable:!0,configurable:!0});Object.defineProperty(DataTransfer.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=wijmo_1.asString(t)},enumerable:!0,configurable:!0});Object.defineProperty(DataTransfer.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0});DataTransfer.prototype.clearData=function(t){null!=t?delete this._data[t]:this._data=null};DataTransfer.prototype.getData=function(t){return this._data[t]||""};DataTransfer.prototype.setData=function(t,e){this._data[t]=e};DataTransfer.prototype.setDragImage=function(t,e,r){var o=DragDropTouch._instance;o._imgCustom=t;o._imgOffset=new wijmo_1.Point(e,r)};return DataTransfer}();exports.DataTransfer=DataTransfer;var DragDropTouch=function(){function DragDropTouch(){this._lastClick=0;this._isDragging=!1;wijmo_1.assert(!DragDropTouch._instance,"DragDropTouch instance already created.");var t=!1;document.addEventListener("test",(function(){}),{get passive(){t=!0;return!0}});var e=document,r=this._touchstart.bind(this),o=this._touchmove.bind(this),i=this._touchend.bind(this),a=!!t&&{passive:!1,capture:!1};e.addEventListener("touchstart",r,a);e.addEventListener("touchmove",o,a);e.addEventListener("touchend",i);e.addEventListener("touchcancel",i)}DragDropTouch.getInstance=function(){return DragDropTouch._instance};DragDropTouch.prototype._touchstart=function(t){if(this._shouldHandle(t)){var e=t.target;if(Date.now()-this._lastClick<DragDropTouch._DBLCLICK&&this._dispatchEvent(t,"dblclick",e)){t.preventDefault();this._reset();return}this._reset();this._lastTouch=t}};DragDropTouch.prototype._touchmove=function(t){if(this._shouldHandle(t)){this._lastTouch=t;if(!this._isDragging){this._isDragging=!0;var e=t.target;if(!this._dispatchEvent(t,"mousemove",e)&&!this._dispatchEvent(t,"mousedown",e)){var r=wijmo_1.closest(t.target,"[draggable]");if(r&&r.draggable){this._dragSource=r;this._ptDown=this._getPoint(t)}}}var o=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",o)){t.preventDefault();return}if(this._dragSource&&!this._img){if(this._getDelta(t)>DragDropTouch._THRESHOLD){this._dispatchEvent(t,"dragstart",this._dragSource);this._createImage(t);this._dispatchEvent(t,"dragenter",o)}}if(this._img){t.preventDefault();if(o!=this._lastTarget){this._dispatchEvent(t,"dragleave",this._lastTarget);this._dispatchEvent(t,"dragenter",o);this._lastTarget=o}this._moveImage(t);this._draggingIsValid=this._dispatchEvent(t,"dragover",o)}}};DragDropTouch.prototype._touchend=function(t){if(this._shouldHandle(t)){var e=t.target,r=this._lastTouch;if(this._isDragging&&this._dispatchEvent(r,"mouseup",e)){t.preventDefault();return}this._destroyImage();if(this._dragSource){this._draggingIsValid&&t.type.indexOf("cancel")<0&&this._dispatchEvent(r,"drop",this._lastTarget);this._dispatchEvent(r,"dragend",this._dragSource);this._reset()}}};DragDropTouch.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2};DragDropTouch.prototype._reset=function(){this._destroyImage();this._dragSource=null;this._lastTouch=null;this._lastTarget=null;this._ptDown=null;this._dataTransfer=new DataTransfer;this._isDragging=!1};DragDropTouch.prototype._getPoint=function(t,e){t&&t.touches&&(t=t.touches[0]);wijmo_1.assert(t&&"clientX"in t,"invalid event?");return 1==e?new wijmo_1.Point(t.pageX,t.pageY):new wijmo_1.Point(t.clientX,t.clientY)};DragDropTouch.prototype._getDelta=function(t){var e=this._getPoint(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)};DragDropTouch.prototype._getTarget=function(t){for(var e=this._getPoint(t),r=document.elementFromPoint(e.x,e.y);r&&"none"==getComputedStyle(r).pointerEvents;)r=r.parentElement;return r};DragDropTouch.prototype._createImage=function(t){this._img&&this._destroyImage();var e=this._imgCustom||this._dragSource;this._img=e.cloneNode(!0);this._copyStyle(e,this._img);this._img.style.top=this._img.style.left="-9999px";if(!this._imgCustom){var r=e.getBoundingClientRect(),o=this._getPoint(t);this._imgOffset=new wijmo_1.Point(o.x-r.left,o.y-r.top);this._img.style.opacity=DragDropTouch._OPACITY.toString()}this._moveImage(t);document.body.appendChild(this._img)};DragDropTouch.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img);this._img=null;this._imgCustom=null};DragDropTouch.prototype._moveImage=function(t){var e=this;requestAnimationFrame((function(){if(e._img){var r=e._getPoint(t,!0);wijmo_1.setCss(e._img,{position:"absolute",pointerEvents:"none",zIndex:999999,left:Math.round(r.x-e._imgOffset.x),top:Math.round(r.y-e._imgOffset.y)})}}))};DragDropTouch.prototype._copyProps=function(t,e,r){for(var o in e)r.test(o)&&(t[o]=e[o])};DragDropTouch.prototype._copyStyle=function(t,e){["id","class","style","draggable"].forEach((function(t){e.removeAttribute(t)}));if(t instanceof HTMLCanvasElement){var r=t,o=e;o.width=r.width;o.height=r.height;o.getContext("2d").drawImage(r,0,0)}for(var i=getComputedStyle(t),a=0;a<i.length;a++){var n=i[a];n.indexOf("transition")<0&&n.indexOf("transform")<0&&(e.style[n]=i[n])}e.style.pointerEvents="none";for(a=0;a<t.children.length;a++)this._copyStyle(t.children[a],e.children[a])};DragDropTouch.prototype._dispatchEvent=function(t,e,r){if(t&&r){var o=document.createEvent("Event"),i=t.touches?t.touches[0]:t;o.initEvent(e,!0,!0);o.button=0;o.which=o.buttons=1;this._copyProps(o,t,/Key$/);this._copyProps(o,i,/(X|Y)$/);o.dataTransfer=this._dataTransfer;r.dispatchEvent(o);return o.defaultPrevented}return!1};DragDropTouch._instance=new DragDropTouch;DragDropTouch._THRESHOLD=5;DragDropTouch._OPACITY=.5;DragDropTouch._DBLCLICK=500;DragDropTouch._CTXMENU=900;return DragDropTouch}();exports.DragDropTouch=DragDropTouch;wijmo_1._registerModule("wijmo.touch",selfModule);