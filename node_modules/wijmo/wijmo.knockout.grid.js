/*!
    *
    * Wijmo Library 5.20231.879
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_knockout_base_1=require("wijmo/wijmo.knockout.base"),mKo=__importStar(require("knockout")),wjcGrid=__importStar(require("wijmo/wijmo.grid")),wjKo=mKo,wjFlexGrid=function(e){__extends(wjFlexGrid,e);function wjFlexGrid(){return null!==e&&e.apply(this,arguments)||this}wjFlexGrid.prototype._getControlConstructor=function(){return wjcGrid.FlexGrid};wjFlexGrid.prototype._createWijmoContext=function(){return new WjFlexGridContext(this)};wjFlexGrid.prototype._initialize=function(){e.prototype._initialize.call(this);wijmo_knockout_base_1.MetaFactory.findProp("itemFormatter",this._metaData.props).updateControl=this._formatterPropHandler};wjFlexGrid.prototype._formatterPropHandler=function(e,t,r,o,n){if(o!==e._userFormatter){e._userFormatter=o;r.invalidate()}return!0};wjFlexGrid._columnTemplateProp="_wjkoColumnTemplate";wjFlexGrid._cellClonedTemplateProp="__wjkoClonedTempl";wjFlexGrid._cellVMProp="__wjkoCellVM";wjFlexGrid._templColIdx="_wjkoTemplColIdx";wjFlexGrid._columnStyleBinding="wjStyle";wjFlexGrid._columnStyleProp="__wjkoStyle";return wjFlexGrid}(wijmo_knockout_base_1.WjBinding);exports.wjFlexGrid=wjFlexGrid;var WjFlexGridContext=function(e){__extends(WjFlexGridContext,e);function WjFlexGridContext(){var t=null!==e&&e.apply(this,arguments)||this;t._wrapperFormatter=t._itemFormatter.bind(t);return t}WjFlexGridContext.prototype._initControl=function(){e.prototype._initControl.call(this);this.control.itemFormatter=this._wrapperFormatter};WjFlexGridContext.prototype._itemFormatter=function(e,t,r,o){var n=e.columns[r],l=n[wjFlexGrid._columnTemplateProp],i=n[wjFlexGrid._columnStyleProp];if((l||i)&&e.cellType==wjcGrid.CellType.Cell){var u=e.grid.editRange;if(u&&u.row===t&&u.col===r)return;if(e.rows[t]instanceof wjcGrid.GroupRow)return;var d=o[wjFlexGrid._cellVMProp],a=o[wjFlexGrid._cellClonedTemplateProp],j=e.rows[t].dataItem;if(d&&o[wjFlexGrid._templColIdx]!=r){o[wjFlexGrid._cellVMProp]=o[wjFlexGrid._cellClonedTemplateProp]=o[wjFlexGrid._templColIdx]=d=a=null;wjKo.cleanNode(o)}if(d){if(a){o.innerHTML="";o.appendChild(a)}d.$row(t);d.$col(r);d.$item()!=j?d.$item(j):d.$item.valueHasMutated()}else{d={$row:wjKo.observable(t),$col:wjKo.observable(r),$item:wjKo.observable(j)};var _=this.bindingContext.extend(d);if(l){o.innerHTML="<div>"+l+"</div>";var p=o.childNodes[0];o[wjFlexGrid._cellClonedTemplateProp]=p}else o.setAttribute("data-bind","style:"+i);o[wjFlexGrid._cellVMProp]=d;o[wjFlexGrid._templColIdx]=r;wjKo.applyBindings(_,o)}var w=o.scrollHeight;e.rows[t].renderHeight<w&&(e.rows.defaultSize=w)}else this._userFormatter&&this._userFormatter(e,t,r,o)};return WjFlexGridContext}(wijmo_knockout_base_1.WjContext);exports.WjFlexGridContext=WjFlexGridContext;var wjFlexGridColumn=function(e){__extends(wjFlexGridColumn,e);function wjFlexGridColumn(){return null!==e&&e.apply(this,arguments)||this}wjFlexGridColumn.prototype._getControlConstructor=function(){return wjcGrid.Column};wjFlexGridColumn.prototype._createControl=function(e){return new wjcGrid.Column};wjFlexGridColumn.prototype._createWijmoContext=function(){return new WjFlexGridColumnContext(this)};return wjFlexGridColumn}(wijmo_knockout_base_1.WjBinding);exports.wjFlexGridColumn=wjFlexGridColumn;var WjFlexGridColumnContext=function(e){__extends(WjFlexGridColumnContext,e);function WjFlexGridColumnContext(){return null!==e&&e.apply(this,arguments)||this}WjFlexGridColumnContext.prototype._initControl=function(){var t=this.parentWjContext;if(t){var r=t.control;if(r.autoGenerateColumns){r.autoGenerateColumns=!1;r.columns.clear()}}e.prototype._initControl.call(this);var o=this.element.innerHTML.trim();this.control[wjFlexGrid._columnTemplateProp]=o;var n=this.allBindings.get(wjFlexGrid._columnStyleBinding);n&&(this.control[wjFlexGrid._columnStyleProp]=n.trim());(o||n)&&this.control._setFlag(wjcGrid.RowColFlags.HasTemplate,!0);this.element.innerHTML=""};return WjFlexGridColumnContext}(wijmo_knockout_base_1.WjContext);exports.WjFlexGridColumnContext=WjFlexGridColumnContext;var wjStyle=function(){function wjStyle(){this.preprocess=function(e,t,r){return wjStyle.quoteString(e)};this.init=function(){}}wjStyle.quoteString=function(e){return null==e?e:"'"+e.replace(/'/g,"\\'")+"'"};wjStyle.unquoteString=function(e){if(!e||e.length<2)return e;"'"===e.charAt(0)&&(e=e.substr(1,e.length-1));return e.replace(/\\\'/g,"'")};return wjStyle}();exports.wjStyle=wjStyle;wjKo.bindingHandlers[wjFlexGrid._columnStyleBinding]=new wjStyle;wjKo.bindingHandlers.wjFlexGrid=new wjFlexGrid;wjKo.bindingHandlers.wjFlexGridColumn=new wjFlexGridColumn;