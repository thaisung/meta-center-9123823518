/*!
    *
    * Wijmo Library 5.20231.879
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_meta_1=require("wijmo/wijmo.meta");!function(){var t=document.createElement("style");t.innerHTML=".wj-web-component {\n            display: inline-block;\n        }";document.head.insertBefore(t,document.head.firstElementChild)}();var WjComponentBehavior=function(){function WjComponentBehavior(t){this._isMounted=!1;this._mountedCBs=[];this._isDomInitialized=!1;this._initialValues=[];this.component=t;this.isWrapper||(this.control=t)}WjComponentBehavior._attach=function(t){return new this(t)};WjComponentBehavior.register=function(t,e){if(null!=e){var o=!!t;if(this._registered.indexOf(e)<0){this._registered.push(e);window.customElements.define(o?t:"wjc-dummy-"+ ++this._cmpRegId,e)}else if(o)throw"Wijmo WebComponents error: component '"+t+"' is already registered.";if(e.wrappedClass){if(o)for(var _loop_1=function(t){var o=t.propertyName;if(t.isNativeControlProperty){o in HTMLElement.prototype&&console.log("WARNING: Wijmo WebComponent '"+e.name+"' exposes the '"+o+"' property which coinsides with the HTMLElement class member.");Object.defineProperty(e.prototype,o,{get:function(){return this.control[o]},set:function(t){this.control[o]=t},enumerable:!0,configurable:!0})}},n=0,i=this._getMetaData(e).props;n<i.length;n++){_loop_1(i[n])}}else for(var r=Object.getPrototypeOf(e.prototype).constructor;r.prototype!==HTMLElement.prototype&&this._registered.indexOf(r)<0;r=Object.getPrototypeOf(r.prototype).constructor){var a="wjc-dummy-"+ ++this._cmpRegId;this._registered.push(r);window.customElements.define(a,r)}}};WjComponentBehavior.getProps=function(t){this._ensureMetadata(t);return t._props};WjComponentBehavior.ensureNs=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];for(var n=t.split("."),i=window,r=!0,a=0,s=n;a<s.length;a++){var p=s[a],h=i[p];if(!h){h=i[p]={};r=!1}i=h}if(e)for(var l=0,m=e;l<m.length;l++){var c=m[l];if(c&&!i[c]){i[c]=null;r=!1}}return r};Object.defineProperty(WjComponentBehavior.prototype,"isWrapper",{get:function(){return null!=this.component.constructor.wrappedClass},enumerable:!0,configurable:!0});WjComponentBehavior.prototype.lhConnected=function(){this.parentComponent=this.component.parentElement;this._prepareControl();this._isChild()&&this._initParent()};WjComponentBehavior.prototype.lhDisconnected=function(){var t=this.control;if(t)if(this._isChild()){var e=this._getParentProp();if(e){var o=this.parentComponent[e];if(wijmo_1.isArray(o)){var n=o.indexOf(t);n>-1&&o.splice(n,1)}}}else wijmo_1.Control;this.parentComponent=null};WjComponentBehavior.prototype.lhAttributeChanged=function(t,e,o){this._onAttributeChanged(t,e,o)};WjComponentBehavior.prototype._initParent=function(){this._callCmpMethod(WjComponentBehavior._beforeInitParent);var t=this._getParentProp();if(t){var e=this.parentComponent.control,o=e[t];if(wijmo_1.isArray(o)){var n=this._getSiblingIndex();(n<0||n>=o.length)&&(n=o.length);o.splice(n,0,this.control)}else e[t]=this.control}this._callCmpMethod(WjComponentBehavior._afterInitParent)};WjComponentBehavior.prototype._prepareControl=function(){if(!this._isDomInitialized){var t=this.component.constructor,e=this.component,o=this.control=t.wrappedClass?this._createControl():e;e.control=o;wijmo_1.addClass(e,"wj-web-component");if(e instanceof wijmo_1.Control&&o.hostElement!==e){var n=o.hostElement;n.style.height="100%";n.style.width="100%"}this._isChild()&&(e.style.display="none");this._initDom();if(!this._siblingId){null==t.siblingId&&(t.siblingId=++WjComponentBehavior._siblingDirId+"");this._siblingId=t.siblingId}e.setAttribute(WjComponentBehavior._typeSiblingIdAttr,this._siblingId);this._flushInitialValues();this._initEvents()}};WjComponentBehavior.prototype._initDom=function(){if(!this._isDomInitialized){this._isDomInitialized=!0;var t=this.control,e=this.component;t instanceof wijmo_1.Control&&t.hostElement!==e&&e.appendChild(t.hostElement)}};WjComponentBehavior.prototype._createControl=function(){var t=this._isChild()?this._isParentInCtor()?this.parentComponent.control:void 0:this._getElement();return new(WjComponentBehavior._getControlType(this.component.constructor))(t)};WjComponentBehavior.prototype._initEvents=function(){var t=this,e=WjComponentBehavior._getMetaData(this.component.constructor);if(e)for(var o=0,n=e.events;o<n.length;o++){!function(e){t.control[e.eventName].addHandler((function(o,n){t.component.dispatchEvent(new CustomEvent(WjComponentBehavior.toDash(e.eventName),{detail:n}))}))}(n[o])}};WjComponentBehavior.prototype._onAttributeChanged=function(t,e,o){var n=this.control;if(e!=o)if(n){this._initialValues&&this._flushInitialValues();var i=WjComponentBehavior,r=i._getPropsMetaData(this.component.constructor),a=t,s=i.toCamelCase(t),p=r[a];null!=p&&(o=p.castValueToType(o));n[s]!==o&&(n[s]=o)}else this._initialValues&&this._initialValues.push({name:t,oldValue:e,newValue:o})};WjComponentBehavior.prototype._flushInitialValues=function(){var t=this._initialValues;if(t){this._initialValues=null;for(var e=0,o=t;e<o.length;e++){var n=o[e];this._onAttributeChanged(n.name,n.oldValue,n.newValue)}}};WjComponentBehavior.prototype._isChild=function(){var t=this.component.constructor;return null!=t.parentProp||null!=t.parentInCtor};WjComponentBehavior.prototype._isParentInCtor=function(){return!0===this.component.constructor.parentInCtor};WjComponentBehavior.prototype._getParentProp=function(){return this.component.getAttribute("wj-property")||this.component.constructor.parentProp};WjComponentBehavior.prototype._getSiblingIndex=function(){var t=this._getElement(),e=t.parentElement;if(!e)return-1;for(var o=e.childNodes,n=-1,i=this._siblingId,r=0;r<o.length;r++){var a=o[r];if(1==a.nodeType&&a.getAttribute(WjComponentBehavior._typeSiblingIdAttr)==i){++n;if(a===t)return n}}return-1};WjComponentBehavior.prototype._getElement=function(){return this.component};WjComponentBehavior._getControlType=function(t){return t.wrappedClass?t.wrappedClass():Object.getPrototypeOf(t.prototype).constructor};WjComponentBehavior._getMetaDataId=function(t){return this._getControlType(t)};WjComponentBehavior._getMetaData=function(t){this._ensureMetadata(t);return t._meta};WjComponentBehavior._getPropsMetaData=function(t){this._ensureMetadata(t);return t._propsMeta};WjComponentBehavior._ensureMetadata=function(t){if(!t._meta){var e=this._getMetaDataId(t);if(e){var o=t._meta=wijmo_meta_1.ControlMetaFactory.getMetaData(e);o.prepare();for(var n=t._propsMeta={},i=o.props,r=t._props=[],a=0,s=i;a<s.length;a++){var p=s[a],h=WjComponentBehavior.toDash(p.propertyName);n[h]=p;r.push(h)}}}};WjComponentBehavior.prototype._callCmpMethod=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n=this.component,i=n[t];"function"==typeof i&&i.apply(n,e)};WjComponentBehavior.toCamelCase=function(t){return wijmo_meta_1.ControlMetaFactory.toCamelCase(t)};WjComponentBehavior.toDash=function(t){return t.replace(/([A-Z])/g,(function(t){return"-"+t[0].toLowerCase()}))};WjComponentBehavior._typeSiblingIdAttr="_wjSiblingId";WjComponentBehavior._behClassProp="_wjBehCl";WjComponentBehavior._behProp="_wjBehaviour";WjComponentBehavior._beforeInitParent="_beforeInitParent";WjComponentBehavior._afterInitParent="_afterInitParent";WjComponentBehavior._siblingDirId=0;WjComponentBehavior._cmpRegId=0;WjComponentBehavior._registered=[];return WjComponentBehavior}();exports.WjComponentBehavior=WjComponentBehavior;